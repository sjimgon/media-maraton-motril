---
// filepath: /home/ser/media-maraton-motril/src/components/Header.astro
import Icon from '../components/Iconos.astro';
---

<header
  id="main-header"
  class="
    fixed top-0 left-0 w-full z-40
    flex justify-center
    bg-blancoMMM
    backdrop-blur
    transition-all duration-300
  "
>
  <nav
    id="main-nav"
    class="
      flex items-center w-full py-0
      relative
      transition-all duration-300
    "
  >

    <!-- Botón hamburguesa solo móvil -->
    <button
      id="menu-toggle"
      class="
        md:hidden
        fixed right-4 top-4 z-30
        flex items-center justify-center
        w-14 h-14
        bg-blancoMMM
        rounded-full shadow-lg
      "
      aria-label="Abrir menú"
      type="button"
    >
      <div class="flex flex-col items-center justify-center w-8 h-8">
        <span class="block w-8 h-1 bg-primarioMMM-500 mb-1 rounded transition-all duration-300"></span>
        <span class="block w-8 h-1 bg-primarioMMM-500 mb-1 rounded transition-all duration-300"></span>
        <span class="block w-8 h-1 bg-primarioMMM-500 rounded transition-all duration-300"></span>
      </div>
    </button>

    <!-- Menú móvil -->
    <ul
      id="main-menu-mobile"
      class="
        w-screen
        flex flex-col items-center justify-evenly
        bg-blancoMMM
        fixed top-0 right-0 h-screen
        transition-transform duration-300
        translate-x-full
        z-10
        md:hidden
      "
    >
      <li>
        <button
          id="prueba-toggle"
          type="button"
          class="
            font-black text-primarioMMM-500
            hover:text-primarioMMM-600
            mb-5 cursor-pointer w-full
            transition-all duration-300
          "
          aria-expanded="false"
        >
          PRUEBA
          <Icon
            id = "pointer-down"
            name="pointer-down"
            class="inline-block fill-primarioMMM-500 w-3 mb-1"
          />
        </button>
        <ul
          id="prueba-dropdown"
          class="
            bg-blancoMMM
            rounded shadow-lg z-10
            max-h-0 overflow-hidden
            transition-all duration-300
          "
        >
          <li>
            <a
              href="/recorrido"
              class="
                block
                px-4 py-2
                font-bold text-primarioMMM-500 text-sm
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50 transition-all duration-300
              "
            >
              RECORRIDO
            </a>
          </li>
          <li>
            <a
              href="/servicios"
              class="
                block
                px-4 py-2
                font-bold text-primarioMMM-500 text-sm
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50 transition-all duration-300
              "
            >
              SERVICIOS AL CORREDOR
            </a>
          </li>
          <li>
            <a
              href="/normativa"
              class="
                block
                px-4 py-2
                font-bold text-primarioMMM-500 text-sm
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50 transition-all duration-300
              "
            >
              NORMATIVA
            </a>
          </li>
          <li>
            <a
              href="/campeones"
              class="
                block
                px-4 py-2
                font-bold text-primarioMMM-500 text-sm
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50 transition-all duration-300
              "
            >
              RUTA DE LOS CAMPEONES
            </a>
          </li>
          <li>
            <a
              href="/voluntarios"
              class="
                block
                px-4 py-2
                font-bold text-primarioMMM-500 text-sm
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50 transition-all duration-300
              "
            >
              VOLUNTARIOS
            </a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/inscripciones" class="font-black text-primarioMMM-500 hover:text-primarioMMM-600 m-5 transition-all duration-300">INSCRIPCIONES</a>
      </li>
      <li>
        <a href="/" class="font-black text-primarioMMM-500 hover:text-primarioMMM-600 m-5 transition-all duration-300">
          <img
            src="/svg/marca/MMM - Blue.svg"
            alt="Logo Media Maratón Ciudad de Motril"
            class="h-14 w-min-16px transition-all duration-300"
          />
        </a>
      </li>
      <li>
        <a href="/multimedia" class="font-black text-primarioMMM-500 hover:text-primarioMMM-600 m-5 transition-all duration-300">MULTIMEDIA</a>
      </li>
      <li>
        <a href="/contacto" class="font-black text-primarioMMM-500 hover:text-primarioMMM-600 m-5 transition-all duration-300">CONTACTO</a>
      </li>
    </ul>

    <!-- Menú escritorio -->
    <ul
      class="
        w-screen flex-row items-center justify-evenly
        md:flex md:static md:h-auto md:bg-transparent
        hidden
        transition-all duration-300
      "
    >
      <li class="relative group">
        <p
          class="
            font-black
            text-primarioMMM-500
            hover:text-primarioMMM-600
            m-5
            transition-all duration-300
            hover:scale-105
          "
        >
          PRUEBA
          <Icon
            id="pointer-down"
            name="pointer-down"
            class="inline-block fill-primarioMMM-500 w-3 mb-1"
          />
        </p>
        <ul
          class="
            absolute left-0 min-w-max
            bg-blancoMMM
            rounded shadow-lg
            opacity-0 group-hover:opacity-100
            group-hover:pointer-events-auto pointer-events-none
            transition-opacity z-10
          "
        >
          <li>
            <a
              href="/recorrido"
              class="
                block
                px-4 py-2
                font-black text-primarioMMM-500
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50/20 hover:scale-105
                transition-all duration-300
              "
            >
              Recorrido
            </a>
          </li>
          <li>
            <a
              href="/servicios"
              class="
                block
                px-4 py-2
                font-black text-primarioMMM-500
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50/20 hover:scale-105
                transition-all duration-300
              "
            >
              Servicios al corredor
            </a>
          </li>
          <li>
            <a
              href="/normativa"
              class="
                block
                px-4 py-2
                font-black text-primarioMMM-500
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50/20 hover:scale-105
                transition-all duration-300
              "
            >
              Normativa
            </a>
          </li>
          <li>
            <a
              href="/campeones"
              class="
                block
                px-4 py-2
                font-black text-primarioMMM-500
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50/20 hover:scale-105
                transition-all duration-300
              "
            >
              Ruta de los campeones
            </a>
          </li>
          <li>
            <a
              href="/voluntarios"
              class="
                block
                px-4 py-2
                font-black text-primarioMMM-500
                hover:text-primarioMMM-600 hover:bg-primarioMMM-50/20 hover:scale-105
                transition-all duration-300
              "
            >
              Voluntarios
            </a>
          </li>
        </ul>
      </li>
      <a
        href="/inscripciones"
        class="
          font-black
          text-primarioMMM-500
          hover:text-primarioMMM-600
          m-1 text-sm
          transition-all duration-300
          hover:scale-105
        "
      >
        INSCRIPCIONES
      </a>
      <li>
        <a
          href="/"
          class="
            font-black
            text-primarioMMM-500
            hover:text-primarioMMM-600
            m-1 text-sm
            transition-all duration-300
          "
        >
          <img
            src="/svg/marca/MMM - Blue.svg"
            alt="Logo Media Maratón Ciudad de Motril"
            class="h-14 w-min-16px transition-all duration-300 hover:scale-105"
          />
        </a>
      </li>
      <a
        href="/multimedia"
        class="
          font-black
          text-primarioMMM-500
          hover:text-primarioMMM-600
          m-1 text-sm
          transition-all duration-300
          hover:scale-105
        "
      >
        MULTIMEDIA
      </a>
      <a
        href="/contacto"
        class="
          font-black
          text-primarioMMM-500
          hover:text-primarioMMM-600
          m-1 text-sm
          transition-all duration-300
          hover:scale-105
        "
      >
        CONTACTO
      </a>
    </ul>
  </nav>
</header>

<script>
  // Menú hamburguesa para móvil
  const toggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('main-menu-mobile');
  if (toggle && menu) {
    toggle.addEventListener('click', () => {
      if (menu.classList.contains('translate-x-full')) {
        menu.classList.remove('translate-x-full');
        menu.classList.add('translate-x-0');
      } else {
        menu.classList.add('translate-x-full');
        menu.classList.remove('translate-x-0');
      }
    });
  }

  // Dropdown PRUEBA en móvil
  const pruebaToggle = document.getElementById('prueba-toggle');
  const pruebaDropdown = document.getElementById('prueba-dropdown');
  const pruebaPointer = document.getElementById('pointer-down');
  let pruebaOpen = false;
  if (pruebaToggle && pruebaDropdown && pruebaPointer) {
  pruebaToggle.addEventListener('click', () => {
    pruebaOpen = !pruebaOpen;
    pruebaToggle.setAttribute('aria-expanded', pruebaOpen.toString());
    if (pruebaOpen) {
      pruebaDropdown.classList.remove('max-h-0', 'overflow-hidden');
      pruebaDropdown.classList.add('max-h-96');
      pruebaPointer.classList.add('rotate-180');
    } else {
      pruebaDropdown.classList.add('max-h-0', 'overflow-hidden');
      pruebaDropdown.classList.remove('max-h-96');
      pruebaPointer.classList.remove('rotate-180');
    }
  });
}

  // Efecto scroll/reducción solo en escritorio + hover para restaurar tamaño
  const header = document.getElementById('main-header');
  const nav = document.getElementById('main-nav');
  // Selecciona los enlaces y el logo del menú de escritorio
  const desktopMenu = nav ? nav.querySelector('.md\\:flex') : null;
  const desktopLinks = desktopMenu ? desktopMenu.querySelectorAll('a, p') : [];
  const desktopLogo = desktopMenu ? desktopMenu.querySelector('img') : null;

  function setOriginalSize() {
    if (header) {
      header.classList.remove('bg-blancoMMM/60', 'backdrop-blur-md');
    }
    if (nav) {
      nav.classList.remove('py-1', 'py-2', 'py-3', 'p-5');
      nav.classList.add('py-0');
    }
    desktopLinks.forEach(link => {
      link.classList.remove('text-base', 'm-2', 'text-lg');
      link.classList.add('text-sm', 'm-1');
    });
    if (desktopLogo) {
      desktopLogo.classList.remove('h-12');
      desktopLogo.classList.add('h-14');
      desktopLogo.classList.remove('h-18');
    }
  }

  function setReducedSize() {
    if (header) {
      header.classList.add('bg-blancoMMM/60', 'backdrop-blur-md');
    }
    if (nav) {
      nav.classList.remove('py-3', 'p-5', 'py-1', 'py-2');
      nav.classList.add('py-0');
    }
    desktopLinks.forEach(link => {
      link.classList.remove('text-xl', 'm-4', 'text-lg');
      link.classList.add('text-sm', 'm-1');
    });
    if (desktopLogo) {
      desktopLogo.classList.add('h-10');
      desktopLogo.classList.remove('h-14', 'h-18', 'h-12');
    }
  }

  function handleScroll() {
    if (window.innerWidth >= 768 && window.scrollY > 30 && header && !header.matches(':hover')) {
      setReducedSize();
    } else {
      setOriginalSize();
    }
  }

  if (header) {
    header.addEventListener('mouseenter', () => {
      if (window.innerWidth >= 768) setOriginalSize();
    });
    header.addEventListener('mouseleave', () => {
      if (window.innerWidth >= 768 && window.scrollY > 30) setReducedSize();
    });
  }

  window.addEventListener('scroll', handleScroll);
  window.addEventListener('resize', handleScroll);
  handleScroll();
</script>